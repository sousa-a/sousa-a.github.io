<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title>EDA and Data visualization | Alessandro O. Sousa</title> <meta name="author" content="Alessandro O. Sousa"> <meta name="description" content="Exploratory Data Analysis and PowerBi reports."> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="https://unpkg.com/bootstrap-table@1.22.1/dist/bootstrap-table.min.css"> <link rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons"> <link rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?19f3075a2d19613090fe9e16b564e1fe" media="" id="highlight_theme_light"> <link href="/assets/css/bootstrap-toc.min.css?6f5af0bb9aab25d79b2448143cbeaa88" rel="stylesheet"> <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20100%20100%22&gt;&lt;text%20y=%22.9em%22%20font-size=%2290%22&gt;%E2%9A%9B%EF%B8%8F&lt;/text&gt;&lt;/svg&gt;"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="/projects/2_project/"> <link rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?e74e74bf055e5729d44a7d031a5ca6a5" media="none" id="highlight_theme_dark"> <script src="/assets/js/theme.js?96d6b3e1c3604aca8b6134c7afdd5db6"></script> <script src="/assets/js/dark_mode.js?9b17307bb950ffa2e34be0227f53558f"></script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/">Alessandro O. Sousa</a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">About</a> </li> <li class="nav-item "> <a class="nav-link" href="/projects/">Projects</a> </li> <li class="nav-item "> <a class="nav-link" href="/cv/">CV</a> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="fas fa-moon"></i> <i class="fas fa-sun"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5"> <div class="row"> <div class="col-sm-3"> <nav id="toc-sidebar" class="sticky-top"></nav> </div> <div class="col-sm-9"> <div class="post"> <header class="post-header"> <h1 class="post-title">EDA and Data visualization</h1> <p class="post-meta">Alessandro O de Sousa</p> <p class="post-tags"> <a href="/blog/2025"> <i class="fas fa-calendar fa-sm"></i> 2025 </a>   ·   <a href="/blog/tag/eda"> <i class="fas fa-hashtag fa-sm"></i> EDA</a>   <a href="/blog/tag/data-visualization"> <i class="fas fa-hashtag fa-sm"></i> Data visualization</a>   <a href="/blog/tag/pandas"> <i class="fas fa-hashtag fa-sm"></i> Pandas</a>   <a href="/blog/tag/numpy"> <i class="fas fa-hashtag fa-sm"></i> Numpy</a>   <a href="/blog/tag/seaborn"> <i class="fas fa-hashtag fa-sm"></i> Seaborn</a>   <a href="/blog/tag/matplotlib"> <i class="fas fa-hashtag fa-sm"></i> Matplotlib</a>   <a href="/blog/tag/plotly"> <i class="fas fa-hashtag fa-sm"></i> Plotly</a>   <a href="/blog/tag/power-bi"> <i class="fas fa-hashtag fa-sm"></i> Power BI</a>   <a href="/blog/tag/postgresql"> <i class="fas fa-hashtag fa-sm"></i> PostgreSQL</a>     ·   <a href="/blog/category/case-study-yellowlynx-medcorp-fictional"> <i class="fas fa-tag fa-sm"></i> Case Study - YellowLynx MedCorp (fictional)</a>   </p> </header> <article class="post-content"> <div id="markdown-content"> <hr> <h1 id="case-study-analysis-of-medicine-usage-in-an-integrated-hospital-network-yellowlynx-medcorp---part-2---eda-and-data-visualization">Case Study: Analysis of medicine usage in an integrated hospital network (YellowLynx MedCorp) - Part 2 - EDA and Data Visualization.</h1> <p><br> This project consists of a fictional scenario in which a health-related enterprize, YellowLynx MedCorp, needs to closely monitor inventory and stock usage, particularly medicines, across its various hospital departments located in a metropolitan area.<br></p> <p>In the <a href="/projects/1_project/">first section</a>, I introduced the business problem, the objetives and the initial steps like data collection, preprocessing and data cleaning.</p> <p>In this second section, I will focus on the <strong>exploratory data analysis (EDA)</strong> and <strong>data visualization</strong>. The visuals included some python libraries like matplotlib, seaborn and Power Bi.</p> <p>So, let’s begin!<br><br></p> <h2 id="1-list-of-medicines">1. List of Medicines</h2> <p>We wanted to discover the sets of medicines that are used in each hospital as well as the ones used exclusively in each hospital. A list of medicines was used for the hospitals as well as the classes each medicine belonged. Theses lists were used to create a dataframe summarizing the data.</p> <h4 id="insights">Insights:<br> </h4> <ul> <li>There is a total of 480 different medicines listed in the present dataset and only 187 (38,9%) of them are used in all hospitals.<br><br> </li> <li>Of the 480 medicines, 32 are used exclusively in LGH2.<br><br> </li> <li>There is a wide range of unit prices for the medicines in this dataset, from $0.01 to $6593.10.<br><br> </li> <li>The max unit price of the medicines used in MSH1 and MSH2 is considerably lower than the ones observed for LGH1, LGH2 and LGH.<br><br> </li> </ul> <meta charset="UTF-8"> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <title>Your Page Title</title> <link href="https://cdnjs.cloudflare.com/ajax/libs/prism-themes/1.9.0/prism-material-dark.min.css" rel="stylesheet"> <details> <summary><b><b>Click to expand/collapse code</b></b></summary> <pre class="line-numbers"><code class="language-python">#Create sets of unique products used in each hospital.
LGH1_product_set = set(hospitals_df['Product'].loc[hospitals_df['SenderLocationID'] == 'LGH1'])
LGH2_product_set = set(hospitals_df['Product'].loc[hospitals_df['SenderLocationID'] == 'LGH2'])
LGH3_product_set = set(hospitals_df['Product'].loc[hospitals_df['SenderLocationID'] == 'LGH3'])
MSH1_product_set = set(hospitals_df['Product'].loc[hospitals_df['SenderLocationID'] == 'MSH1'])
MSH2_product_set = set(hospitals_df['Product'].loc[hospitals_df['SenderLocationID'] == 'MSH2'])

#Set of unique medicines used in all 5 hospitals.
hospitals_product_set = len(set(hospitals_df['Product']))

#Create sets of unique medicine classes used in each hospital.
LGH1_class_set = set(hospitals_df['ClassName'].loc[hospitals_df['SenderLocationID'] == 'LGH1'])
LGH2_class_set = set(hospitals_df['ClassName'].loc[hospitals_df['SenderLocationID'] == 'LGH2'])
LGH3_class_set = set(hospitals_df['ClassName'].loc[hospitals_df['SenderLocationID'] == 'LGH3'])
MSH1_class_set = set(hospitals_df['ClassName'].loc[hospitals_df['SenderLocationID'] == 'MSH1'])
MSH2_class_set = set(hospitals_df['ClassName'].loc[hospitals_df['SenderLocationID'] == 'MSH2'])

#Create a set of unique products used in all 5 hospitals.
Product_set_all_hospitals = (LGH1_product_set &amp; LGH2_product_set &amp; LGH3_product_set &amp; MSH1_product_set &amp; MSH2_product_set)

#Create sets of unique products used exclusively in each hospital.
LGH1_only_product_set = (LGH1_product_set - LGH2_product_set - LGH3_product_set - MSH1_product_set - MSH2_product_set)
LGH2_only_product_set = (LGH2_product_set - LGH1_product_set - LGH3_product_set - MSH1_product_set - MSH2_product_set)
LGH3_only_product_set = (LGH3_product_set - LGH1_product_set - LGH2_product_set - MSH1_product_set - MSH2_product_set)
MSH1_only_product_set = (MSH1_product_set - LGH1_product_set - LGH2_product_set - LGH3_product_set - MSH2_product_set)
MSH2_only_product_set = (MSH2_product_set - LGH1_product_set - LGH2_product_set - LGH3_product_set - MSH1_product_set)

#Transform the above created sets into lists.
LGH1_only_product_list = sorted([x for x in LGH1_only_product_set])
LGH2_only_product_list = sorted([x for x in LGH2_only_product_set])
LGH3_only_product_list = sorted([x for x in LGH3_only_product_set])
MSH1_only_product_list = sorted([x for x in MSH1_only_product_set])
MSH2_only_product_list = sorted([x for x in MSH2_only_product_set])

#Number of hospital departments.
lgh1_n_departments = set(hospitals_df['ReceiverName'].loc[
    (hospitals_df['SenderLocationID'] == 'LGH1') &amp;
    (hospitals_df['ReceiverName'] != 'SUPPLIER') &amp;
    (hospitals_df['ReceiverName'].str.contains('LGH1')) &amp;
    (~hospitals_df['ReceiverName'].str.contains('PHARMACY', na=False))])

lgh2_n_departments = set(hospitals_df['ReceiverName'].loc[
    (hospitals_df['SenderLocationID'] == 'LGH2') &amp;
    (hospitals_df['ReceiverName'] != 'SUPPLIER') &amp;
    (hospitals_df['ReceiverName'].str.contains('LGH2')) &amp;
    (~hospitals_df['ReceiverName'].str.contains('PHARMACY', na=False))])

lgh3_n_departments = set(hospitals_df['ReceiverName'].loc[
    (hospitals_df['SenderLocationID'] == 'LGH3') &amp;
    (hospitals_df['ReceiverName'] != 'SUPPLIER') &amp;
    (hospitals_df['ReceiverName'].str.contains('LGH3')) &amp;
    (~hospitals_df['ReceiverName'].str.contains('PHARMACY', na=False))])

msh1_n_departments = set(hospitals_df['ReceiverName'].loc[
    (hospitals_df['SenderLocationID'] == 'MSH1') &amp;
    (hospitals_df['ReceiverName'] != 'SUPPLIER') &amp;
    (hospitals_df['ReceiverName'].str.contains('MSH1')) &amp;
    (~hospitals_df['ReceiverName'].str.contains('PHARMACY', na=False))])

msh2_n_departments = set(hospitals_df['ReceiverName'].loc[
    (hospitals_df['SenderLocationID'] == 'MSH2') &amp;
    (hospitals_df['ReceiverName'] != 'SUPPLIER') &amp;
    (hospitals_df['ReceiverName'].str.contains('MSH2')) &amp;
    (~hospitals_df['ReceiverName'].str.contains('PHARMACY', na=False))])

#Create function that define the min, max and average of the medicines unit price.
def min_price(df,hospital):
    return "{:.2f}".format(df['StandartPrice'].loc[(df['SenderLocationID']==hospital) &amp; (df['StandartPrice']&gt;0)].min())
def max_price (df,hospital):
    return "{:.2f}".format(df['StandartPrice'].loc[df['SenderLocationID']==hospital].max())
def avg_price(df,hospital):
    return "{:.2f}".format(np.array(list(set(df['StandartPrice'].loc[df['SenderLocationID']==hospital]))).mean())

#Average number of medicines used by department.
lgh1_mean_med_n = hospitals_df.loc[hospitals_df['SenderLocationID']=='LGH1']


print("Total Number of medicines: ", hospitals_product_set,
      "\nTotal Number of medicines used in all hospitals: ", len(Product_set_all_hospitals))

#Create a dataframe that describes the length of each set.
medicines_df = pd.DataFrame(data= {
  'Hospital Name':                    ['LGH1','LGH2','LGH3','MSH1','MSH2'],
  'Medicines used in the hospital':   [
                                        len(LGH1_product_set),
                                        len(LGH2_product_set),
                                        len(LGH3_product_set),
                                        len(MSH1_product_set),
                                        len(MSH2_product_set)
                                      ],
  'Medicines exclusively used':       [
                                        len(LGH1_only_product_set),
                                        len(LGH2_only_product_set),
                                        len(LGH3_only_product_set),
                                        len(MSH1_only_product_set),
                                        len(MSH2_only_product_set)
                                      ],
  'N.º of medicine classes':          [
                                        len(LGH1_class_set),
                                        len(LGH2_class_set),
                                        len(LGH3_class_set),
                                        len(MSH1_class_set),
                                        len(MSH2_class_set)
                                      ],
  'N.º of departments':               [
                                        len(lgh1_n_departments),
                                        len(lgh2_n_departments),
                                        len(lgh3_n_departments),
                                        len(msh1_n_departments),
                                        len(msh2_n_departments)
                                      ],
  'Medicines unit price min ($)':     [
                                        min_price(hospitals_df,'LGH1'),
                                        min_price(hospitals_df,'LGH2'),
                                        min_price(hospitals_df,'LGH3'),
                                        min_price(hospitals_df,'MSH1'),
                                        min_price(hospitals_df,'MSH2')
                                      ],
  'Medicines unit price max ($)': 
                                      [
                                        max_price(hospitals_df,'LGH1'),
                                        max_price(hospitals_df,'LGH2'),
                                        max_price(hospitals_df,'LGH3'),
                                        max_price(hospitals_df,'MSH1'),
                                        max_price(hospitals_df,'MSH2')
                                      ],

  'Medicines unit price average ($)': [
                                        avg_price(hospitals_df,'LGH1'),
                                        avg_price(hospitals_df,'LGH2'),
                                        avg_price(hospitals_df,'LGH3'),
                                        avg_price(hospitals_df,'MSH1'),
                                        avg_price(hospitals_df,'MSH2')
                                      ]
                                  })
</code></pre> </details> <script src="https://cdn.jsdelivr.net/npm/prismjs/prism.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/prismjs/components/prism-python.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/prismjs/plugins/line-numbers/prism-line-numbers.min.js"></script> <p><br></p> <ul> <li>Total Number of medicines: 480<br><br> </li> <li>Total Number of medicines used in all hospitals: 187<br><br> </li> </ul> <caption><b>Table 5. Quantity of medicines used in each hospital.</b></caption> <table> <thead> <tr> <th style="text-align: center"> </th> <th style="text-align: center">Hospital Name</th> <th style="text-align: center">Medicines used in the hospital</th> <th style="text-align: center">Medicines exclusively used</th> <th style="text-align: center">N.º of medicine classes</th> <th style="text-align: center">N.º of departments</th> <th style="text-align: center">Medicines unit price min ($)</th> <th style="text-align: center">Medicines unit price max ($)</th> <th style="text-align: center">Medicines unit price average ($)</th> </tr> </thead> <tbody> <tr> <td style="text-align: center">0</td> <td style="text-align: center">LGH1</td> <td style="text-align: center">424</td> <td style="text-align: center">2</td> <td style="text-align: center">123</td> <td style="text-align: center">36</td> <td style="text-align: center">0.01</td> <td style="text-align: center">6593.10</td> <td style="text-align: center">34.50</td> </tr> <tr> <td style="text-align: center">1</td> <td style="text-align: center">LGH2</td> <td style="text-align: center">459</td> <td style="text-align: center">32</td> <td style="text-align: center">126</td> <td style="text-align: center">47</td> <td style="text-align: center">0.01</td> <td style="text-align: center">6593.10</td> <td style="text-align: center">41.49</td> </tr> <tr> <td style="text-align: center">2</td> <td style="text-align: center">LGH3</td> <td style="text-align: center">418</td> <td style="text-align: center">2</td> <td style="text-align: center">121</td> <td style="text-align: center">38</td> <td style="text-align: center">0.01</td> <td style="text-align: center">6593.10</td> <td style="text-align: center">37.31</td> </tr> <tr> <td style="text-align: center">3</td> <td style="text-align: center">MSH1</td> <td style="text-align: center">226</td> <td style="text-align: center">6</td> <td style="text-align: center">94</td> <td style="text-align: center">10</td> <td style="text-align: center">0.01</td> <td style="text-align: center">76.28</td> <td style="text-align: center">2.74</td> </tr> <tr> <td style="text-align: center">4</td> <td style="text-align: center">MSH2</td> <td style="text-align: center">290</td> <td style="text-align: center">2</td> <td style="text-align: center">96</td> <td style="text-align: center">15</td> <td style="text-align: center">0.01</td> <td style="text-align: center">499.20</td> <td style="text-align: center">6.03</td> </tr> </tbody> </table> <p><br></p> <h2 id="2-total-stock-usage-tsu">2. Total Stock Usage (TSU)</h2> <p>We also wanted to evaluate the total stock usage averages ($) across hospitals by quarter as well as the monthly and daily averages by quarter.<br> A <em>Tsu</em> class and methods were created to evaluate each aggregate values. The concept of Total Stock Usage (TSU) was used in the analyses to follow.<br></p> <meta charset="UTF-8"> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <title>Your Page Title</title> <link href="https://cdnjs.cloudflare.com/ajax/libs/prism-themes/1.9.0/prism-material-dark.min.css" rel="stylesheet"> <details> <summary><b><b>Click to expand/collapse code</b></b></summary> <pre class="line-numbers"><code class="language-python">class Tsu():
    
    #Filter conditions
    base_conditions = ((hospitals_df['InOut'] == 'Out') &amp;
                       (hospitals_df['ReceiverName'] != 'SUPPLIER') &amp;
                       (~hospitals_df['ReceiverName'].str.contains('PHARMACY', na=False)))
   
    def __init__(self,df,hospital):
        self.df = df
        self.hospital = hospital
        
    def month_sum(self,year,month):
        '''Calculates the total stock usage (TSU) by month.'''
        return "{:.2f}".format(df['StockValue'].loc[(
                                        self.base_conditions &amp;
                                        (df['SenderLocationID'] == self.hospital) &amp;
                                        (df['year'] == year) &amp;
                                        (df['quarter'] == month) &amp;
                                        (df['ReceiverName'].str.contains(self.hospital)))].sum())
    
    def quarter_sum(self,year,quarter):
        '''Calculates the total stock usage (TSU) by quarter.'''
        df = self.df
        return "{:.2f}".format(df['StockValue'].loc[(
                                        self.base_conditions &amp;
                                        (df['SenderLocationID'] == self.hospital) &amp;
                                        (df['year'] == year) &amp;
                                        (df['quarter'] == quarter) &amp;
                                        (df['ReceiverName'].str.contains(self.hospital)))].sum())
    
    def year_avg_df(self,year):
        '''Calculates the total stock usage (TSU) by year and returns a dataframe.'''
        df = self.df
        return df.loc[(
                       self.base_conditions &amp;
                       (df['SenderLocationID'] == self.hospital) &amp;
                       (df['year'] == year) &amp;
                       (df['ReceiverName'].str.contains(self.hospital)))].mean()

    def monthly_avg_quarter(self,year,quarter):
        '''Calculates the total stock usage (TSU) monthly average.'''
        return (df.loc[self.base_conditions &amp;
                                  (df['SenderLocationID'] == self.hospital) &amp;
                                  (df['year'] == year) &amp;
                                  (df['quarter'] == quarter) &amp;
                                  (df['ReceiverName'].str.contains(self.hospital))
                                  ].groupby(['month','SenderLocationID'])['StockValue'].sum()).mean()
    
    def monthly_avg_year(self,year):
        '''Calculates the total stock usage (TSU) monthly average.'''
        df = df.loc[self.base_conditions &amp;
                     (df['SenderLocationID'] == self.hospital) &amp;
                     (df['year'] == year) &amp;
                     (df['ReceiverName'].str.contains(self.hospital))
                     ].groupby(['month','SenderLocationID'])['StockValue'].sum().mean()

    def daily_avg_quarter(self,year,quarter):
        '''Calculates the total stock usage (TSU) daily average.'''
        return (df.loc[self.base_conditions &amp;
                                  (df['SenderLocationID'] == self.hospital) &amp;
                                  (df['year'] == year) &amp;
                                  (df['quarter'] == quarter) &amp;
                                  (df['ReceiverName'].str.contains(self.hospital))
                                  ].groupby(['Date','SenderLocationID'])['StockValue'].sum()).mean()
  
    def month_sum_df(self):
        '''Returns a dataframe describing the total stock usage TSU by month, absolute and percentage
        changes from previous month and cumulative TSU'''
        df = self.df.loc[(self.base_conditions &amp;
                     (self.df['SenderLocationID'] == self.hospital) &amp;
                     (self.df['ReceiverName'].str.contains(self.hospital))
                     )].pivot_table(index='year_month',
                           values='StockValue',
                           aggfunc='sum').reset_index().rename(columns={'year_month':'Year-month','StockValue':'TSU'})
        df['SenderLocationID'] = self.hospital
        df['Year'] = df['Year-month'].str[0:4].astype(int)
        df['Month'] = df['Year-month'].str[5:]
        df['Change from previous month'] = df['TSU'] - df['TSU'].shift(1)
        df['Percentage Change from last month'] = ((df['TSU'] / df['TSU'].shift(1)) -1)*100
        df['Cumulative Sum by year'] = pd.concat([
                                                  pd.Series(df['TSU'].loc[df['Year-month'].str.contains('2020')].cumsum()),
                                                  pd.Series(df['TSU'].loc[df['Year-month'].str.contains('2021')].cumsum()),
                                                  pd.Series(df['TSU'].loc[df['Year-month'].str.contains('2022')].cumsum()),
                                                  pd.Series(df['TSU'].loc[df['Year-month'].str.contains('2023')].cumsum())])
        
        yearly_avg = df.groupby('Year')['TSU'].mean()
        df = df.merge(yearly_avg.rename('Yearly TSU average'), left_on='Year', right_index=True)
        df['Deviation from yearly TSU average'] = df['TSU'] - df['Yearly TSU average']
        df['Normalized (mean) deviation from the mean'] = (df['Deviation from yearly TSU average'] - (df['Deviation from yearly TSU average'].mean())
                                                           )/(max(df['Deviation from yearly TSU average']) - min(df['Deviation from yearly TSU average']))
        df.fillna(0, inplace=True)
        return df
    
    def monthly_avg_quarter_df(self):
        '''Returns a dataframe describing total stock usage (TSU) monthly average by quarter.'''
        df = ((self.df.loc[self.base_conditions &amp;
                           (self.df['SenderLocationID'] == self.hospital) &amp;
                           (self.df['ReceiverName'].str.contains(self.hospital))
                           ].groupby('year_quarter')['StockValue'].sum())/3).reset_index().drop(columns='year_quarter').rename(columns={'StockValue':f'{self.hospital} - TSU monthly average '}).squeeze()
        return df
    
    def quarter_sum_by_dept_df(self,year,quarter):
        '''Returns a dataframe describing total stock usage (TSU) by quarter grouped by hospital department.'''
        df = self.df
        df = df.loc[(hospitals_df['SenderLocationID'] == self.hospital) &amp;
                     (df['year'] == year) &amp;
                     (df['quarter'] == quarter) &amp;
                     (df['InOut'] == 'Out') &amp;
                     (df['ReceiverName'] != 'SUPPLIER') &amp;
                     (df['ReceiverName'].str.contains(self.hospital)) &amp;
                     (~df['ReceiverName'].str.contains('PHARMACY', na=False))
                     ].groupby(['ReceiverName'])['StockValue'].sum().reset_index().sort_values(by = ['StockValue'], ascending=False)
        df['ReceiverName'] = df['ReceiverName'].str[5:]
        df['ReceiverName'] = df['ReceiverName'].str.replace("_", " ")
        return df
    
    
    def month_sum_by_medicine_df(self, year):
        '''Returns a dataframe describing total stock usage (TSU) by medicine by month. It also includes the 
        Total Stock Usage mean (TSU), the deaviation from the yearly TSU mean and a normalized deviation for
        each medicine in each year'''
        #Silence the PerformanceWarning (PW) in pandas
        from warnings import simplefilter
        simplefilter(action="ignore", category=pd.errors.PerformanceWarning)

        df = self.df
        df_pivot = df.loc[(self.base_conditions &amp;
                        (df['SenderLocationID'] == self.hospital) &amp;
                        (df['ReceiverName'].str.contains(self.hospital)))]
        
        #Pivot the DataFrame and reset the index
        df_pivot = df_pivot.pivot_table(index='year_month',
                                        columns='SKU',
                                        values='StockValue',
                                        aggfunc='sum')
        df_pivot.index = pd.to_datetime(df_pivot.index)
        
        #Calculate yearly TSU mean and add deviation columns
        yearly_mean = df_pivot.loc[str(year)].mean()
        
        #Iterate over columns and add deviation columns
        deviation_columns = pd.DataFrame()
        for col in df_pivot.columns:
            product_name = col
            deviation = df_pivot[product_name] - yearly_mean[product_name]
            normalized_deviation = (df_pivot[product_name] - yearly_mean[product_name]) / (df_pivot[product_name].max() - df_pivot[product_name].min())
            deviation_columns[(f"{product_name}_Deviation")] = deviation
            deviation_columns[(f"{product_name}_NormalizedDeviation")] = normalized_deviation

        df_pivot = pd.concat([df_pivot, deviation_columns], axis=1)
        df_pivot = df_pivot.reindex(sorted(df_pivot.columns), axis=1)
        
        return df_pivot
    
#Create Tsu instances for each hospital 
lgh1_tsu = Tsu(hospitals_df,'LGH1')
lgh2_tsu = Tsu(hospitals_df,'LGH2')
lgh3_tsu = Tsu(hospitals_df,'LGH3')
msh1_tsu = Tsu(hospitals_df,'MSH1')
msh2_tsu = Tsu(hospitals_df,'MSH2')

#Call the month_sum_df method for each hospital
lgh1_month_tsu = lgh1_tsu.month_sum_df()
lgh2_month_tsu = lgh2_tsu.month_sum_df()
lgh3_month_tsu = lgh3_tsu.month_sum_df()
msh1_month_tsu = msh1_tsu.month_sum_df()
msh2_month_tsu = msh2_tsu.month_sum_df()

#Call the month_sum_by_medicine_df method for each hospital
lgh1_month_tsu_by_medicine_2020 = lgh1_tsu.month_sum_by_medicine_df(2020)
lgh1_month_tsu_by_medicine_2021 = lgh1_tsu.month_sum_by_medicine_df(2021)
lgh1_month_tsu_by_medicine_2022 = lgh1_tsu.month_sum_by_medicine_df(2022)
lgh1_month_tsu_by_medicine_2023 = lgh1_tsu.month_sum_by_medicine_df(2023)

lgh2_month_tsu_by_medicine_2020 = lgh2_tsu.month_sum_by_medicine_df(2020)
lgh2_month_tsu_by_medicine_2021 = lgh2_tsu.month_sum_by_medicine_df(2021)
lgh2_month_tsu_by_medicine_2022 = lgh2_tsu.month_sum_by_medicine_df(2022)
lgh2_month_tsu_by_medicine_2023 = lgh2_tsu.month_sum_by_medicine_df(2023)

lgh3_month_tsu_by_medicine_2020 = lgh3_tsu.month_sum_by_medicine_df(2020)
lgh3_month_tsu_by_medicine_2021 = lgh3_tsu.month_sum_by_medicine_df(2021)
lgh3_month_tsu_by_medicine_2022 = lgh3_tsu.month_sum_by_medicine_df(2022)
lgh3_month_tsu_by_medicine_2023 = lgh3_tsu.month_sum_by_medicine_df(2023)

msh1_month_tsu_by_medicine_2020 = msh1_tsu.month_sum_by_medicine_df(2020)
msh1_month_tsu_by_medicine_2021 = msh1_tsu.month_sum_by_medicine_df(2021)
msh1_month_tsu_by_medicine_2022 = msh1_tsu.month_sum_by_medicine_df(2022)
msh1_month_tsu_by_medicine_2023 = msh1_tsu.month_sum_by_medicine_df(2023)

msh2_month_tsu_by_medicine_2020 = msh2_tsu.month_sum_by_medicine_df(2020)
msh2_month_tsu_by_medicine_2021 = msh2_tsu.month_sum_by_medicine_df(2021)
msh2_month_tsu_by_medicine_2022 = msh2_tsu.month_sum_by_medicine_df(2022)
msh2_month_tsu_by_medicine_2023 = msh2_tsu.month_sum_by_medicine_df(2023)
</code></pre> </details> <script src="https://cdn.jsdelivr.net/npm/prismjs/prism.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/prismjs/components/prism-python.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/prismjs/plugins/line-numbers/prism-line-numbers.min.js"></script> <p><br></p> <h2 id="3-visualizing-total-stock-usage-tsu-time-series-">3. Visualizing Total Stock usage (TSU) time series <br> </h2> <h3 id="31-total-stock-usage-tsu-monthly-averages-by-quarter-in-each-hospital">3.1 Total Stock usage (TSU) monthly averages by quarter in each hospital<br> </h3> <p>We used the monthly_avg_quarter_df method from he <em>TSU</em> class to visualize the TSU variation among hospitals over time.<br></p> <h5 id="insights-1">Insights:<br> </h5> <ul> <li>Historically, LGH2 has the highest TSU monthly average from 2020 to 2023.<br><br> </li> <li>MSH1 and MSH2 TSU monthly averages ranges from some thousands to a couple ten of thousands in contrast to the larger hospitals.<br><br> </li> <li>A decline in TSU is observed following the 2th quarter of 2021 in LGH1, LGH2 and LGH3.<br><br> </li> <li>LGH2 had the most drastic decrease in TSU monthly average from over $1,062,425 (2022_Q2) to aproximately $677,917 (2023_Q1), a decrease greater than 36% in one year or $384,508. This result is followed by a 29% decrease in LGH1 and a 24% in LGH3 in the same period.<br><br> </li> <li>The drastic decrease observed may be related to a severe cost reduction policy implemented.<br><br> </li> </ul> <meta charset="UTF-8"> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <title>Your Page Title</title> <link href="https://cdnjs.cloudflare.com/ajax/libs/prism-themes/1.9.0/prism-material-dark.min.css" rel="stylesheet"> <details> <summary><b><b>Click to expand/collapse code</b></b></summary> <pre class="line-numbers"><code class="language-python">index=['2020_Q1','2020_Q2','2020_Q3','2020_Q4','2021_Q1','2021_Q2','2021_Q3','2021_Q4','2022_Q1','2022_Q2','2022_Q3','2022_Q4','2023_Q1','2023_Q2']
       
tsu_average_by_quarter = pd.DataFrame(data={
                                            'Year_Quarter': index,
                                            'LGH1': lgh1_tsu.monthly_avg_quarter_df(),
                                            'LGH2': lgh2_tsu.monthly_avg_quarter_df(),
                                            'LGH3': lgh3_tsu.monthly_avg_quarter_df(),
                                            'MSH1': msh1_tsu.monthly_avg_quarter_df(),
                                            'MSH2': msh2_tsu.monthly_avg_quarter_df()
                                            }
                                    )


covid_dates = ['2020_Q1','2020_Q2','2020_Q3','2020_Q4','2021_Q1','2021_Q2','2021_Q3','2021_Q4','2022_Q1','2022_Q2','2022_Q3','2022_Q4','2023_Q1','2023_Q2']
covid_cases_quarter = [65691,99829,223370,236278,313483,379483,284718,205687,184953,98543,69854,58323,55968,50575]
covid_for_plotly = pd.DataFrame({"year_quarter":covid_dates, "Number of new COVID-19 cases":covid_cases_quarter})
tsu_average_by_quarter = pd.concat([tsu_average_by_quarter, covid_for_plotly], axis=1, join='outer')
tsu_average_by_quarter = tsu_average_by_quarter.drop(columns="year_quarter")
tsu_average_by_quarter
</code></pre> </details> <script src="https://cdn.jsdelivr.net/npm/prismjs/prism.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/prismjs/components/prism-python.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/prismjs/plugins/line-numbers/prism-line-numbers.min.js"></script> <p><br></p> <caption><b>Table 5. Total Stock usage (TSU) monthly averages by quarter in each hospital.</b></caption> <table> <thead> <tr> <th style="text-align: center"> </th> <th style="text-align: center">Year_Quarter</th> <th style="text-align: center">LGH1</th> <th style="text-align: center">LGH2</th> <th style="text-align: center">LGH3</th> <th style="text-align: center">MSH1</th> <th style="text-align: center">MSH2</th> <th style="text-align: center">Number of new COVID-19 cases</th> </tr> </thead> <tbody> <tr> <td style="text-align: center">0</td> <td style="text-align: center">2020_Q1</td> <td style="text-align: center">584469.719803</td> <td style="text-align: center">1.005823e+06</td> <td style="text-align: center">394224.317504</td> <td style="text-align: center">15142.801151</td> <td style="text-align: center">1629.184566</td> <td style="text-align: center">65691</td> </tr> <tr> <td style="text-align: center">1</td> <td style="text-align: center">2020_Q2</td> <td style="text-align: center">611123.858982</td> <td style="text-align: center">1.183376e+06</td> <td style="text-align: center">481970.147399</td> <td style="text-align: center">13452.095758</td> <td style="text-align: center">1835.331100</td> <td style="text-align: center">99829</td> </tr> <tr> <td style="text-align: center">2</td> <td style="text-align: center">2020_Q3</td> <td style="text-align: center">762355.693219</td> <td style="text-align: center">1.063248e+06</td> <td style="text-align: center">445955.642822</td> <td style="text-align: center">17129.978427</td> <td style="text-align: center">1894.346501</td> <td style="text-align: center">223370</td> </tr> <tr> <td style="text-align: center">3</td> <td style="text-align: center">2020_Q4</td> <td style="text-align: center">677922.616686</td> <td style="text-align: center">1.051400e+06</td> <td style="text-align: center">405286.835901</td> <td style="text-align: center">16262.291220</td> <td style="text-align: center">1570.892629</td> <td style="text-align: center">236278</td> </tr> <tr> <td style="text-align: center">4</td> <td style="text-align: center">2021_Q1</td> <td style="text-align: center">729652.000549</td> <td style="text-align: center">9.353152e+05</td> <td style="text-align: center">484370.244446</td> <td style="text-align: center">16626.946719</td> <td style="text-align: center">1921.911455</td> <td style="text-align: center">313483</td> </tr> <tr> <td style="text-align: center">5</td> <td style="text-align: center">2021_Q2</td> <td style="text-align: center">939892.998876</td> <td style="text-align: center">1.123392e+06</td> <td style="text-align: center">819098.354167</td> <td style="text-align: center">19352.070669</td> <td style="text-align: center">3065.312052</td> <td style="text-align: center">379483</td> </tr> <tr> <td style="text-align: center">6</td> <td style="text-align: center">2021_Q3</td> <td style="text-align: center">595303.355057</td> <td style="text-align: center">9.987052e+05</td> <td style="text-align: center">481757.705896</td> <td style="text-align: center">17052.489648</td> <td style="text-align: center">2374.327521</td> <td style="text-align: center">284718</td> </tr> <tr> <td style="text-align: center">7</td> <td style="text-align: center">2021_Q4</td> <td style="text-align: center">603629.149970</td> <td style="text-align: center">1.033993e+06</td> <td style="text-align: center">386744.003036</td> <td style="text-align: center">16410.879170</td> <td style="text-align: center">2208.455088</td> <td style="text-align: center">205687</td> </tr> <tr> <td style="text-align: center">8</td> <td style="text-align: center">2022_Q1</td> <td style="text-align: center">515347.035820</td> <td style="text-align: center">9.303260e+05</td> <td style="text-align: center">458699.197765</td> <td style="text-align: center">14820.465187</td> <td style="text-align: center">2082.696870</td> <td style="text-align: center">184953</td> </tr> <tr> <td style="text-align: center">9</td> <td style="text-align: center">2022_Q2</td> <td style="text-align: center">590182.515206</td> <td style="text-align: center">1.062425e+06</td> <td style="text-align: center">410737.299097</td> <td style="text-align: center">14014.073721</td> <td style="text-align: center">2623.604837</td> <td style="text-align: center">98543</td> </tr> <tr> <td style="text-align: center">10</td> <td style="text-align: center">2022_Q3</td> <td style="text-align: center">489867.779233</td> <td style="text-align: center">1.020302e+06</td> <td style="text-align: center">358564.303953</td> <td style="text-align: center">13296.457535</td> <td style="text-align: center">2592.601316</td> <td style="text-align: center">69854</td> </tr> <tr> <td style="text-align: center">11</td> <td style="text-align: center">2022_Q4</td> <td style="text-align: center">446807.078755</td> <td style="text-align: center">7.031597e+05</td> <td style="text-align: center">333782.060710</td> <td style="text-align: center">14453.159960</td> <td style="text-align: center">2836.337501</td> <td style="text-align: center">58323</td> </tr> <tr> <td style="text-align: center">12</td> <td style="text-align: center">2023_Q1</td> <td style="text-align: center">416799.671392</td> <td style="text-align: center">6.779172e+05</td> <td style="text-align: center">311154.820465</td> <td style="text-align: center">14291.067702</td> <td style="text-align: center">2904.396312</td> <td style="text-align: center">55968</td> </tr> <tr> <td style="text-align: center">13</td> <td style="text-align: center">2023_Q2</td> <td style="text-align: center">542799.468164</td> <td style="text-align: center">7.269198e+05</td> <td style="text-align: center">339136.741646</td> <td style="text-align: center">13754.758362</td> <td style="text-align: center">3864.039913</td> <td style="text-align: center">50575</td> </tr> </tbody> </table> <p><br></p> <meta charset="UTF-8"> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <title>Your Page Title</title> <link href="https://cdnjs.cloudflare.com/ajax/libs/prism-themes/1.9.0/prism-material-dark.min.css" rel="stylesheet"> <details> <summary><b><b>Click to expand/collapse code</b></b></summary> <pre class="line-numbers"><code class="language-python">import plotly.express as px
import plotly.graph_objects as go
from plotly.subplots import make_subplots

colors = ["#0173B2", "#DE8F05", "#029E73", "#D55E00", "#CC78BC"]

fig = px.line(
              tsu_average_by_quarter, x='Year_Quarter', y=['LGH1',
                                                           'LGH2',
                                                           'LGH3',
                                                           'MSH1',
                                                           'MSH2'],
              color_discrete_map={col: colors[idx] for idx, col in enumerate(tsu_average_by_quarter.columns[1:6])} 
            )
              
fig.add_trace(go.Scatter(
                         x=tsu_average_by_quarter['Year_Quarter'],
                         y=tsu_average_by_quarter['Number of new COVID-19 cases'],
                         mode='lines',
                         yaxis='y2',
                         name='Number of new COVID-19 cases',
                         line=dict(color='red', dash='dot')
                         )
            )

fig.update_layout(
    autosize=False, width=1200, height=800,
    title='Total Stock Usage (TSU) monthly average by quarter.',
    title_x=0.5,
    xaxis_title='Quarter',
    yaxis_title='TSU (million $)',
    yaxis2=dict(
        title='New Covid Cases (Thousands)',
        overlaying='y',
        side='right'
    ),
    xaxis=dict(showline=True, showgrid=False),
    yaxis=dict(showline=True, showgrid=False),
    paper_bgcolor='white',
    plot_bgcolor='lightgrey',
    font=dict(family='Open Sans', size=16, color='black'),
    legend=dict(font=dict(size=14), y=1.0, x=1.1),
    yaxis2_title_standoff=40
)
fig.update_yaxes(nticks=5, secondary_y=True)
fig.show()
</code></pre> </details> <script src="https://cdn.jsdelivr.net/npm/prismjs/prism.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/prismjs/components/prism-python.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/prismjs/plugins/line-numbers/prism-line-numbers.min.js"></script> <p><br></p> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/figure2_tsu_quarter-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/figure2_tsu_quarter-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/figure2_tsu_quarter-1400.webp"></source> <img src="/assets/img/figure2_tsu_quarter.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" data-zoomable="" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> <div class="caption">Figure 2. Total Stock Usage (TSU) monthly average by quarter.</div> <p><br></p> <h3 id="32-total-stock-usage-tsu-by-month-in-each-hospital">3.2 Total Stock usage (TSU) by month in each hospital<br><br> </h3> <h4 id="insights-2">Insights:<br> </h4> <ul> <li>In the time period depicted, the TSU line plots show a increase from 2020 to 2021 and a deacrease in 2022 and 2023;</li> <li>The prominent increase in TSU in the first 2 quarter of 2021 coincides with the peak in the number of cases of infections with the Sars-Cov2 virus (COVID19) and hospitalizations, except for LGH2.</li> </ul> <meta charset="UTF-8"> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <title>Your Page Title</title> <link href="https://cdnjs.cloudflare.com/ajax/libs/prism-themes/1.9.0/prism-material-dark.min.css" rel="stylesheet"> <details> <summary><b><b>Click to expand/collapse code</b></b></summary> <pre class="line-numbers"><code class="language-python">fig, axes = plt.subplots(nrows=2, ncols=3, figsize=(18,8))
sns.set_style("whitegrid", {'grid.linestyle': ':'})
fig.subplots_adjust(left=0.15, top=0.95)    

def tsu_line_plotter(df,ax):
    sns.set_style("whitegrid", {'grid.linestyle': ':'})
    palette = sns.color_palette(["#0173B2", "#DE8F05", "#029E73", "#D55E00"], as_cmap=True)
    plot = sns.lineplot(data=df,x='Month',y=df['TSU']/1000, hue='Year', ax=ax, palette=palette)
    plt.tight_layout(pad=5)
    sns.move_legend(ax,loc='upper right', title=None, frameon=False,fontsize=8)
    ax.set_yticks(ax.get_yticks())
    ax.set_xlabel('Month')
    ax.set_ylabel('TSU (K$)')
    ax.set_title(df['SenderLocationID'][0])
    ax.set_xticks(ax.get_xticks())
    plot.set(xlim=(0,12))
    sns.set(style="ticks")

tsu_line_plotter(lgh1_month_tsu,axes[0,0])
tsu_line_plotter(lgh2_month_tsu,axes[0,1])
tsu_line_plotter(lgh3_month_tsu,axes[0,2])
tsu_line_plotter(msh1_month_tsu,axes[1,0])
tsu_line_plotter(msh2_month_tsu,axes[1,1])

axes[1,2].set_axis_off()
plt.legend(loc='upper right', title='Year')
plt.grid()
sns.set_style("whitegrid", {'grid.linestyle': ':'})
fig.suptitle('TSU by month over the years across hospitals.')
plt.show()
</code></pre> </details> <script src="https://cdn.jsdelivr.net/npm/prismjs/prism.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/prismjs/components/prism-python.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/prismjs/plugins/line-numbers/prism-line-numbers.min.js"></script> <p><br></p> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/figure3_tsu_years-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/figure3_tsu_years-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/figure3_tsu_years-1400.webp"></source> <img src="/assets/img/figure3_tsu_years.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" data-zoomable="" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> <div class="caption">Figure 3. Total Stock Usage (TSU) by month over the years across hospitals.</div> <p><br></p> <h3 id="33-total-stock-usage-tsu-across-hospital-departments-top-10">3.3 Total Stock usage (TSU) across hospital departments (TOP 10)</h3> <p>We identified the top 10 hospital departments with the highest TSU in the first quarter of 2023.</p> <h4 id="insights-3">Insights:<br><br> </h4> <ul> <li>The emergency departments of the larger hospitals are the top stock consumers. At least half of the pharmacy stock was used in the emergency departments in the first quarter of 2023.<br><br> </li> <li>LGH1 has a very busy Gynecology and Obstetrics department. In LGH2 the Nephrology dept. and LGH3 stands out for its ICU.<br><br> </li> <li>MSH1 and MSH2 are much smaller hospitals specialized in psychiatry and cancer patients palliative care, respectively.<br><br> </li> <li>Their stock usage reflects the specialization.<br><br> </li> </ul> <meta charset="UTF-8"> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <title>Your Page Title</title> <link href="https://cdnjs.cloudflare.com/ajax/libs/prism-themes/1.9.0/prism-material-dark.min.css" rel="stylesheet"> <details> <summary><b><b>Click to expand/collapse code</b></b></summary> <pre class="line-numbers"><code class="language-python">#Create bar plots for the pharmacy stock usage across hospitals departments - tops 10 departments
fig, axes = plt.subplots(2, 3, figsize=(20,10))
sns.set(style="darkgrid")

lgh1_bar_plot = sns.barplot(data=lgh1_tsu.quarter_sum_by_dept_df(2023,1).nlargest(10, 'StockValue'),
                            x='StockValue',
                            y='ReceiverName',
                            palette="colorblind",
                            ax=axes[0,0])

lgh1xlabels = ['{:,.0f}'.format(x) + 'K' for x in lgh1_bar_plot.get_xticks()/1000]

lgh2_bar_plot = sns.barplot(data=lgh2_tsu.quarter_sum_by_dept_df(2023,1).nlargest(10, 'StockValue'),
                            x='StockValue',
                            y='ReceiverName',
                            palette="colorblind",
                            ax=axes[0,1])

lgh2xlabels = ['{:,.0f}'.format(x) + 'K' for x in lgh2_bar_plot.get_xticks()/1000]

lgh3_bar_plot = sns.barplot(data=lgh3_tsu.quarter_sum_by_dept_df(2023,1).nlargest(10, 'StockValue'),
                            x='StockValue',
                            y='ReceiverName',
                            palette="colorblind",
                            ax=axes[0,2])

lgh3xlabels = ['{:,.0f}'.format(x) + 'K' for x in lgh3_bar_plot.get_xticks()/1000]

msh1_bar_plot = sns.barplot(data=msh1_tsu.quarter_sum_by_dept_df(2023,1).nlargest(10, 'StockValue'),
                            x='StockValue',
                            y='ReceiverName',
                            ax=axes[1,0])

msh1xlabels = ['{:,.0f}'.format(x) + 'K' for x in msh1_bar_plot.get_xticks()/1000]

msh2_bar_plot = sns.barplot(data=msh2_tsu.quarter_sum_by_dept_df(2023,1).nlargest(10, 'StockValue'),
                            x='StockValue',
                            y='ReceiverName',
                            ax=axes[1,1])

msh2xlabels = ['{:,.0f}'.format(x) + 'K' for x in msh2_bar_plot.get_xticks()/1000]

#Subtitles and axis labels
axes[0,0].set_title('LGH1')
axes[0,0].set_xlabel('Stock usage ($)')
axes[0,0].set_ylabel('Department')
axes[0,0].set_xticks(axes[0,0].get_xticks().tolist())
axes[0,0].set_xticklabels(labels=lgh1xlabels, rotation=0)
axes[0,1].set_title('LGH2')
axes[0,1].set_xlabel('Stock usage ($)')
axes[0,1].set_xticks(axes[0,1].get_xticks().tolist())
axes[0,1].set_xticklabels(labels=lgh2xlabels, rotation=0)
axes[0,1].set_ylabel(None)
axes[0,2].set_title('LGH3')
axes[0,2].set_xlabel('Stock usage ($)')
axes[0,2].set_xticks(axes[0,2].get_xticks().tolist())
axes[0,2].set_xticklabels(labels=lgh3xlabels, rotation=0)
axes[0,2].set_ylabel(None)
axes[1,0].set_title('MSH1')
axes[1,0].set_xlabel('Stock usage ($)')
axes[1,0].set_xticks(axes[1,0].get_xticks().tolist())
axes[1,0].set_xticklabels(labels=msh1xlabels, rotation=0)
axes[1,0].set_ylabel('Department')
axes[1,1].set_title('MSH2')
axes[1,1].set_xlabel('Stock usage ($)')
axes[1,1].set_xticks(axes[1,1].get_xticks().tolist())
axes[1,1].set_xticklabels(labels=msh2xlabels, rotation=0)
axes[1,1].set_ylabel(None)
axes[1,2].set_axis_off()

fig.tight_layout()
fig.suptitle('Top 10 departments - 2023-Q1 stock usage', fontsize=16)
plt.subplots_adjust(top=0.90)
plt.show()
</code></pre> </details> <script src="https://cdn.jsdelivr.net/npm/prismjs/prism.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/prismjs/components/prism-python.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/prismjs/plugins/line-numbers/prism-line-numbers.min.js"></script> <p><br></p> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/figure4_tsu_top_dept-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/figure4_tsu_top_dept-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/figure4_tsu_top_dept-1400.webp"></source> <img src="/assets/img/figure4_tsu_top_dept.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" data-zoomable="" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> <div class="caption">Figure 4. Total Stock Usage (TSU) across hospital departments (2023-Q1).</div> <p><br></p> <h3 id="34-deviation-from-the-average-tsu">3.4 Deviation from the average TSU</h3> <p>In order to analyse the behaviour of Total Stock Usage (TSU) along the year, we defined a function to visualize the deviation from the mean values for a given year. We had previously created a column named ‘Normalized (mean) deviation from the mean’.<br></p> <p>In the resulting multiplot, a red dashed line represents the mean yealy TSU value for each hospital.In each plot the blue line represents the deviations from the mean TSU value, after the normalization process.<br><br></p> <h4 id="insights-4">Insights:<br><br> </h4> <ul> <li>There is not a clear picture of seasonality at the aggregate level.<br><br> </li> <li>It is well known that the Sars-CoV (COVID-19) pandemic resulted in an increase in the numbers os hospitalization as well as prices of medications and other healt-related products.<br><br> </li> <li>In contrast, some healthcare services and elective surgeries procedures where almost haulted during the pandemic.<br><br> </li> <li>Further analysis by medicine should allow the identification of groups of seasonal products and their impact in the TSU.<br><br> </li> </ul> <meta charset="UTF-8"> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <title>Your Page Title</title> <link href="https://cdnjs.cloudflare.com/ajax/libs/prism-themes/1.9.0/prism-material-dark.min.css" rel="stylesheet"> <script src="https://cdn.jsdelivr.net/npm/prismjs/components/prism-python.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/prismjs/plugins/line-numbers/prism-line-numbers.min.js"></script> <details> <summary><b><b>Click to expand/collapse code</b></b></summary> <pre class="line-numbers"><code class="language-python">fig, axes = plt.subplots(nrows=4, ncols=5, figsize=(30,20))

lgh1_2020,lgh1_2021,lgh1_2022,lgh1_2023 = axes[0,0],axes[1,0],axes[2,0],axes[3,0]
lgh2_2020,lgh2_2021,lgh2_2022,lgh2_2023 = axes[0,1],axes[1,1],axes[2,1],axes[3,1]
lgh3_2020,lgh3_2021,lgh3_2022,lgh3_2023 = axes[0,2],axes[1,2],axes[2,2],axes[3,2]
msh1_2020,msh1_2021,msh1_2022,msh1_2023 = axes[0,3],axes[1,3],axes[2,3],axes[3,3]
msh2_2020,msh2_2021,msh2_2022,msh2_2023 = axes[0,4],axes[1,4],axes[2,4],axes[3,4]

def tsu_line_plotter_deviation_from_mean(df,ax,year):
    # Plot a red dotted line indicating the mean
    plt.axhline(y=0, color='r', linestyle='dotted', label='Mean', linewidth=2)
    sns.lineplot(data=df.loc[df['Year'] == year],x='Month',y=df['Normalized (mean) deviation from the mean'], ax=ax,color="b")
    ax1 = ax.twinx()
    #sns.lineplot(data=df,x='Month',y=df['Yearly TSU average']/1000,ax=ax1,color="r")
    #ax.set_xticks(ax.get_xticks())
    ax.set_yticks(ax.get_yticks())
    ax.set_xlabel('Month')
    ax.set_xticklabels(labels=df['Month'])
    ax.set_ylabel('Deviation (mean normalized)',color="b")
    ax1.set_ylabel('TSU average',color="r")
    #ax.set_xticks(range(len(df['Month'])))
    #ax1.set_yticks(ax1.get_yticks())
    sns.set_style("whitegrid", {'grid.linestyle': ':'})
    ax.set_ylim(-0.7,0.7)
    ax1.set_ylim(-0.7,0.7)
    #ax.set_ylim(min(df['Normalized (mean) deviation from the mean'].loc[df['Year'] == year]), max(df['Normalized (mean) deviation from the mean'].loc[df['Year'] == year]))
    #ax1.set_ylim(min(df['Normalized (mean) deviation from the mean'].loc[df['Year'] == year]), max(df['Normalized (mean) deviation from the mean'].loc[df['Year'] == year]))
    
tsu_line_plotter_deviation_from_mean(lgh1_month_tsu, lgh1_2020, 2020)
tsu_line_plotter_deviation_from_mean(lgh1_month_tsu, lgh1_2021, 2021)
tsu_line_plotter_deviation_from_mean(lgh1_month_tsu, lgh1_2022, 2022)
tsu_line_plotter_deviation_from_mean(lgh1_month_tsu, lgh1_2023, 2023)
tsu_line_plotter_deviation_from_mean(lgh2_month_tsu, lgh2_2020, 2020)
tsu_line_plotter_deviation_from_mean(lgh2_month_tsu, lgh2_2021, 2021)
tsu_line_plotter_deviation_from_mean(lgh2_month_tsu, lgh2_2022, 2022)
tsu_line_plotter_deviation_from_mean(lgh2_month_tsu, lgh2_2023, 2023)
tsu_line_plotter_deviation_from_mean(lgh3_month_tsu, lgh3_2020, 2020)
tsu_line_plotter_deviation_from_mean(lgh3_month_tsu, lgh3_2021, 2021)
tsu_line_plotter_deviation_from_mean(lgh3_month_tsu, lgh3_2022, 2022)
tsu_line_plotter_deviation_from_mean(lgh3_month_tsu, lgh3_2023, 2023)
tsu_line_plotter_deviation_from_mean(msh1_month_tsu, msh1_2020, 2020)
tsu_line_plotter_deviation_from_mean(msh1_month_tsu, msh1_2021, 2021)
tsu_line_plotter_deviation_from_mean(msh1_month_tsu, msh1_2022, 2022)
tsu_line_plotter_deviation_from_mean(msh1_month_tsu, msh1_2023, 2023)
tsu_line_plotter_deviation_from_mean(msh2_month_tsu, msh2_2020, 2020)
tsu_line_plotter_deviation_from_mean(msh2_month_tsu, msh2_2021, 2021)
tsu_line_plotter_deviation_from_mean(msh2_month_tsu, msh2_2021, 2021)
tsu_line_plotter_deviation_from_mean(msh2_month_tsu, msh2_2021, 2021)
tsu_line_plotter_deviation_from_mean(msh2_month_tsu, msh2_2022, 2022)
tsu_line_plotter_deviation_from_mean(msh2_month_tsu, msh2_2023, 2023)

cols = ['LGH1','LGH2','LGH3','MSH1','MSH2']
rows = [2020, 2021, 2022, 2023]

column_fontsize = 16
row_fontsize = 16

pad = 10 # in points

for ax, col in zip(axes[0], cols):
    ax.annotate(col, xy=(0.5, 1), xytext=(0, pad),
                xycoords='axes fraction', textcoords='offset points',
                size=column_fontsize, ha='center', va='baseline')
    
for ax, row in zip(axes[:,0], rows):
    ax.annotate(row, xy=(0, 0.5), xytext=(-ax.yaxis.labelpad - pad, 0),
                xycoords=ax.yaxis.label, textcoords='offset points',
                size=row_fontsize, ha='right', va='center')
    
fig.subplots_adjust(left=0.15, top=0.80)    
fig.tight_layout(pad=7,w_pad=3)
fig.suptitle('Mean Normalized Deviation from the yearly TSU average', fontsize=24)
plt.show()
</code></pre> </details> <script src="https://cdn.jsdelivr.net/npm/prismjs/prism.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/prismjs/components/prism-python.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/prismjs/plugins/line-numbers/prism-line-numbers.min.js"></script> <p><br></p> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/figure5_dev_from_mean-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/figure5_dev_from_mean-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/figure5_dev_from_mean-1400.webp"></source> <img src="/assets/img/figure5_dev_from_mean.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" data-zoomable="" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> <div class="caption">Figure 5. Mean Normalized Deviation from the yearly Total Stock Usage (TSU) average.</div> <h2 id="4-data-load-into-a-postgresql-database">4. Data load into a PostGreSQL database</h2> <p>Briefly, the processed data were exported to a CSV file and then inserted into a table in an existing PostGreSQL database.<br><br></p> <meta charset="UTF-8"> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <title>Your Page Title</title> <link href="https://cdnjs.cloudflare.com/ajax/libs/prism-themes/1.9.0/prism-material-dark.min.css" rel="stylesheet"> <details> <summary><b>Click to expand/collapse code</b></summary> <pre class="line-numbers"><code class="language-sql">CREATE TABLE IF NOT EXISTS public.hospitals_fact
(
	"SenderLocationID" character varying(30) COLLATE pg_catalog."default" NOT NULL,
	"OrderID" character varying(30) COLLATE pg_catalog."default" NOT NULL,
	"Date" date,
	"ReceiverID" character varying(30) COLLATE pg_catalog."default" NOT NULL,
	"ReceiverName" character varying(100) COLLATE pg_catalog."default" NOT NULL,
	"InOut" "char",
	"MovementType" character varying(20) COLLATE pg_catalog."default" NOT NULL,
	"SKU" character varying(12) COLLATE pg_catalog."default" NOT NULL,
	"Product" character varying(100) COLLATE pg_catalog."default" NOT NULL,
	"ClassID" character varying(12) COLLATE pg_catalog."default" NOT NULL,
	"ClassName" character varying(200) COLLATE pg_catalog."default" NOT NULL,
	"MeasurementUnit" character varying(5) COLLATE pg_catalog."default" NOT NULL,
	"StandartPrice" double precision,
	"Quantity" double precision NOT NULL,
	"RemainingStock" double precision NOT NULL,
	"StockValue" double precision NOT NULL,
	CONSTRAINT hospitals_fact_pkey PRIMARY KEY ("SenderLocationID", "OrderID", "SKU", "Quantity")
)

TABLESPACE pg_default;

ALTER TABLE IF EXISTS public.hospitals_fact
	OWNER to postgres;
</code></pre> </details> <script src="https://cdn.jsdelivr.net/npm/prismjs/prism.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/prismjs/components/prism-python.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/prismjs/plugins/line-numbers/prism-line-numbers.min.js"></script> <p><br></p> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/figure6_postgre_table_creation-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/figure6_postgre_table_creation-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/figure6_postgre_table_creation-1400.webp"></source> <img src="/assets/img/figure6_postgre_table_creation.jpg" class="img-fluid rounded z-depth-1" width="auto" height="auto" data-zoomable="" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> <div class="caption">Figure 6. Table creation in a PostGreSQL database.</div> <p><br></p> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/figure7_postgre_csv_load-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/figure7_postgre_csv_load-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/figure7_postgre_csv_load-1400.webp"></source> <img src="/assets/img/figure7_postgre_csv_load.jpg" class="img-fluid rounded z-depth-1" width="auto" height="auto" data-zoomable="" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> <div class="caption">Figure 7. Data load into the PostGreSQL.</div> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/figure8_postgre_test_query-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/figure8_postgre_test_query-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/figure8_postgre_test_query-1400.webp"></source> <img src="/assets/img/figure8_postgre_test_query.jpg" class="img-fluid rounded z-depth-1" width="auto" height="auto" data-zoomable="" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> <div class="caption">Figure 8. Test query.</div> <p><br></p> <h2 id="5-visualizations-metrics-and-reports-in-power-bi">5. Visualizations, metrics and reports in Power BI</h2> <p>In Power BI, SQL queries were designed to retrieve information from the database in order to construct reports with relevant metrics for managerial purposes.<br><br></p> <p>The CSV file could certainly have been used directly as a data source in Power BI. However, for the purpose of demonstrating knowledge and capability, the PostgreSQL database was connected to Power BI.</p> <p>We created 4 Report pages:</p> <ul> <li> <strong>Report 1 - Pharmacy Stock Availability, Coverage and Usage.</strong><br><br> The client was particularly interest in the stock availavility and coverage across hospitals, the inventory turnover ratio, the total stock value each hospital holds at any moment.<br> There was also interest in analysing the stock usage by quarter and the deviation from a goal determined by the board of directors.<br><br> </li> <li> <strong>Report 2 - ABC Analysis.</strong><br><br> There was also interest in analysing the stock usage by quarter and the deviation from a goal determined by the board of directors.<br><br> </li> <li> <strong>Report 3 - Stock Usage by Hospital by week of the year/quarter.</strong><br><br> Managers also needed to follow the distribution of inventory categories, using ABC analysis, and to monitor the total stock usage by hospital department along with the most expensive products.<br><br> </li> <li> <strong>Report 4 - Stock Usage by Hospital Department.</strong><br><br> In order to prevent performance issues, it is preferable to perform calculations as upstream as possible. However, we used a mix of queries in Power Query and metrics/calculated columns using DAX to further demonstrate our ability to use these alternatives.<br><br> </li> </ul> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/figure9_prostgres_query_%20example-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/figure9_prostgres_query_%20example-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/figure9_prostgres_query_%20example-1400.webp"></source> <img src="/assets/img/figure9_prostgres_query_%20example.jpg" class="img-fluid rounded z-depth-1" width="auto" height="auto" data-zoomable="" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> <div class="caption">Figure 9. Example of a PostGreSQL query used to populate tables in Power Bi.</div> <p><br></p> <h5 id="power-bi-report-1---pharmacy-stock-availability-coverage-and-usage">Power BI Report 1 - Pharmacy Stock Availability, Coverage and Usage.</h5> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/figure10_powerbi_page1_availability_and_coverage-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/figure10_powerbi_page1_availability_and_coverage-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/figure10_powerbi_page1_availability_and_coverage-1400.webp"></source> <img src="/assets/img/figure10_powerbi_page1_availability_and_coverage.jpg" class="img-fluid rounded z-depth-1" width="auto" height="auto" data-zoomable="" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> <div class="caption">Figure 10. PowerBI report 1</div> <p><br></p> <h5 id="power-bi-report-2---abc-analysis">Power BI Report 2 - ABC Analysis.</h5> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/figure11_powerbi_page2_abc_analysis-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/figure11_powerbi_page2_abc_analysis-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/figure11_powerbi_page2_abc_analysis-1400.webp"></source> <img src="/assets/img/figure11_powerbi_page2_abc_analysis.jpg" class="img-fluid rounded z-depth-1" width="auto" height="auto" data-zoomable="" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> <div class="caption">Figure 11. PowerBI report 2</div> <p><br></p> <h5 id="power-bi-report-3---stock-usage-by-hospital-by-week-of-the-yearquarter">Power BI Report 3 - Stock Usage by Hospital by week of the year/quarter.</h5> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/figure12_powerbi_page3_stock_usage_by_hospital_by_week-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/figure12_powerbi_page3_stock_usage_by_hospital_by_week-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/figure12_powerbi_page3_stock_usage_by_hospital_by_week-1400.webp"></source> <img src="/assets/img/figure12_powerbi_page3_stock_usage_by_hospital_by_week.jpg" class="img-fluid rounded z-depth-1" width="auto" height="auto" data-zoomable="" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> <div class="caption">Figure 12. PowerBI report 3</div> <p><br></p> <h5 id="power-bi-report-4---stock-usage-by-hospital-department-quarter">Power BI Report 4 - Stock Usage by Hospital Department (quarter).</h5> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/figure13_powerbi_page4_stock_usage_by_hospital-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/figure13_powerbi_page4_stock_usage_by_hospital-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/figure13_powerbi_page4_stock_usage_by_hospital-1400.webp"></source> <img src="/assets/img/figure13_powerbi_page4_stock_usage_by_hospital.jpg" class="img-fluid rounded z-depth-1" width="auto" height="auto" data-zoomable="" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> <div class="caption">Figure 13. PowerBI report 4</div> <p><br><br> <br></p> <h2 id="6-conclusion">6. Conclusion</h2> <p>Finally, in this case studyit was possible to accomplish the following:</p> <ol> <li> <p>To demonstrate end-to-end capability in understanding business problems and proposing solutions, always using an analytical mindset and attention to detail.<br></p> </li> <li> <p>To demonstrate proficiency in relational databases, SQL and Python for data cleaning/preparation, analysis, and insights.<br></p> </li> <li> <p>To demonstrate the ability to integrate and summarize the acquired knowledge in reports, executive summaries, and dashboards that provide relevant information related to inventory management and financial expenditures information to the executive team in a timely and reliable manner.<br><br></p> </li> </ol> <p>In the <a href="/projects/3_project/">third section</a>, I will evaluate the application of predictive models for medicine usage in the hospitals of YellowLynx MedCorp network.</p> <hr> </div> </article> </div> </div> </div> </div> <footer class="fixed-bottom"> <div class="container mt-0"> © Copyright 2025 Alessandro O. Sousa. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="external nofollow noopener">GitHub Pages</a>. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@4/imagesloaded.pkgd.min.js"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.0.8/dist/medium-zoom.min.js" integrity="sha256-7PhEpEWEW0XXQ0k6kQrPKwuoIomz8R8IYyuU1Qew4P8=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?7b30caa5023af4af8408a472dc4e1ebb"></script> <script defer src="/assets/js/bootstrap-toc.min.js?c82ff4de8b0955d6ff14f5b05eed7eb6"></script> <script defer src="https://unpkg.com/bootstrap-table@1.22.1/dist/bootstrap-table.min.js"></script> <script src="/assets/js/no_defer.js?d633890033921b33e0ceb13d22340a9c"></script> <script defer src="/assets/js/common.js?acdb9690d7641b2f8d40529018c71a01"></script> <script defer src="/assets/js/copy_code.js?c9d9dd48933de3831b3ee5ec9c209cac" type="text/javascript"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script> <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> </body> </html>